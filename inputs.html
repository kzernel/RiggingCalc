<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rigging Inputs – Page 2</title>
  <style>
    body { font-family: Arial; margin: 2rem; }
    label, input, button { display: block; margin: 1rem 0; }
    img { max-width: 600px; margin-top: 2rem; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>Lift Inputs</h1>

  <div id="summary"></div>
  <img id="rigDiagram" src="" alt="Rigging Diagram" style="display:none;">

  <form onsubmit="event.preventDefault(); calculateRigging();">
    <label for="grossLoad">Gross Load (W):</label>
    <input type="number" id="grossLoad" required> lbs

    <label for="blockHeight">Load Height (Hl):</label>
    <input type="number" id="blockHeight" required> ft

    <label for="loadDistance">Load Distance (Dl):</label>
    <input type="number" id="loadDistance" required> ft

    <label for="topBlockHeight">Top Block Height (Htb):</label>
    <input type="number" id="topBlockHeight" required> ft

    <label for="hoistDistance">Hoist Distance (Dh):</label>
    <input type="number" id="hoistDistance" required> ft

    <div id="tagDistanceContainer" style="display:none;">
      <label for="tagDistance">Tag Distance (Dt):</label>
      <input type="number" id="tagDistance"> ft
    </div>

    <button type="submit">Calculate</button>
  </form>

  <div id="results"></div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const tower = params.get("tower") || "";
    const rig = params.get("rig") || "";
    const loadPart = params.get("loadPart") || "";
    const loadLoc = params.get("loadLoc") || "";
    const trolleyTag = params.get("trolleyTag") || "";

    const towerLabel = tower === "self-support" ? "sst" : tower;
    const rigLabel = rig.toUpperCase();

    const summary = `
      <p><strong>Tower:</strong> ${tower}</p>
      <p><strong>Rigging Config:</strong> ${rig}</p>
      ${loadPart ? `<p><strong>Load Part:</strong> ${loadPart}</p>` : ""}
      ${loadLoc && tower === "self-support" ? `<p><strong>Load Location:</strong> ${loadLoc}</p>` : ""}
      ${trolleyTag ? `<p><strong>Trolley Tag:</strong> ${trolleyTag}</p>` : ""}
    `;
    document.getElementById("summary").innerHTML = summary;

    let fileName = `Type ${rigLabel}`;
    if (trolleyTag) {
      fileName += `_${trolleyTag}_${towerLabel}`;
    } else if (loadLoc) {
      fileName += `_${loadLoc} tower`;
      if (loadPart) fileName += `_${loadPart}`;
      fileName += `_${towerLabel}`;
    } else if (loadPart) {
      fileName += `_${loadPart}`;
      if (loadLoc) fileName += `_${loadLoc}`;
      fileName += `_${towerLabel}`;
    } else {
      fileName += `_outside_${towerLabel}`;
    }
    fileName = fileName.replace(/\s+/g, '_') + ".png";
    const imagePath = `/mnt/data/rigging_diagrams_v2/${fileName}`;

    const showTagDistance = ["A", "B"].includes(rigLabel);
    document.getElementById("tagDistanceContainer").style.display = showTagDistance ? "block" : "none";

    const img = document.getElementById("rigDiagram");
    img.src = imagePath;
    img.style.display = "block";
    img.onerror = () => {
      img.style.display = "none";
      console.warn("Image not found:", fileName);
    };

    function calculateRigging() {
      const W = parseFloat(document.getElementById("grossLoad").value);
      const Hl = parseFloat(document.getElementById("blockHeight").value);
      const Dl = parseFloat(document.getElementById("loadDistance").value);
      const Htb = parseFloat(document.getElementById("topBlockHeight").value);
      const Dh = parseFloat(document.getElementById("hoistDistance").value);
      const Dt = parseFloat(document.getElementById("tagDistance").value) || 0;

      const POFL = loadPart === "two" ? 2 : 1;
      const sheaves = ["B", "D"].includes(rigLabel) ? 2 : 1;
      const efficiency = Math.pow(0.97, sheaves);

      const angleRadians = Math.atan(Htb / Dh);
      const angleDegrees = angleRadians * (180 / Math.PI);
      const lineTension = W / (POFL * efficiency);
      const horizForce = lineTension * Math.sin(angleRadians);

      const tagLineForce = (["A", "B"].includes(rigLabel) && Dt > 0 && Dl > 0)
        ? (horizForce * Dl / Dt)
        : 0;

      const minSafeTagDistance = (tagLineForce > 200 && horizForce > 0)
        ? (horizForce * Dl / 200)
        : null;

      document.getElementById("results").innerHTML = `
        <h3>Calculated Forces</h3>
        <p><strong>Rigging Angle (θ):</strong> ${angleDegrees.toFixed(2)}°</p>
        <p><strong>Total Line Tension (T):</strong> ${lineTension.toFixed(2)} lbs</p>
        <p><strong>Estimated Horizontal Force (H):</strong> ${horizForce.toFixed(2)} lbs</p>
        <p><strong>Tag Distance (Dt):</strong> ${Dt.toFixed(2)} ft — used to control load swing and prevent contact with the tower</p>
        ${tagLineForce > 0 ? `$1
        ${minSafeTagDistance ? `<p style='color:orange;'><strong>⚠️ Tag Line Force exceeds 200 lbs.</strong><br>To reduce force below 200 lbs, increase tag distance to at least <strong>${minSafeTagDistance.toFixed(1)} ft</strong>.</p>` : ""}` : ""}
        <p><em>POFL = ${POFL}, Sheaves = ${sheaves}, Efficiency = ${(efficiency * 100).toFixed(2)}%</em></p>`;
    }
  </script>
</body>
</html>


